<!--try1.html-->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>TODO App</title>
  <style>
    body {
      background-color: rgb(192, 192, 192);
    }

    .chooseUserMenu {
      position: fixed;
      top: 40px;
      left: 0;
      width: 25%;
      min-width: 250px;
      max-width: 400px;
      height: 100%;
      background-color: rgb(170, 170, 170);
      overflow-y: auto;
      z-index: 1;
    }

    .menuTODO {
      position: fixed;
      top: 80px;
      left: 0;
      margin-left: clamp(250px, 25%, 400px);
      width: calc(100% - clamp(250px, 25%, 400px));
      height: calc(100% - 80px);
      overflow-y: auto;
      overflow-x: hidden;
      background-color: rgb(192, 192, 192);
      z-index: 0;
    }

    .userItem {
      padding: 12px 16px;
      margin: 4px 8px;
      background-color: #fff;
      border-radius: 6px;
      font-size: 16px;
      font-weight: 500;
      color: #333;
      cursor: pointer;
      transition: background-color 0.2s ease;
    }

    .userItem:hover {
      background-color: #d0d0d0;
    }

    .TODO {
      width: 98%;
      box-sizing: border-box;
      padding: 12px 16px;
      margin: 10px;
      background-color: #fff;
      border-radius: 6px;
      font-family: sans-serif;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .breadcrumbs {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 40px;
      background-color: #e0e0e0;
      display: flex;
      align-items: center;
      padding: 0 20px;
      font-size: 18px;
      font-weight: 500;
      z-index: 2;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .breadcrumbItem {
      margin-right: 2px;
      cursor: pointer;
      color: #0077cc;
    }

    .breadcrumbItem:hover {
      text-decoration: underline;
    }

    .topNavMenu {
  position: fixed;
  top: 40px;
  left: clamp(250px, 25%, 400px);
  width: calc(100% - clamp(250px, 25%, 400px));
  height: 40px;
  background-color: rgb(210, 210, 210);
  display: flex;
  align-items: center;
  padding: 0 20px;
  gap: 12px;
  border-bottom: 2px solid #ccc;
  z-index: 2;
}


    .postItem {
      width: 98%;
      box-sizing: border-box;
      padding: 12px 16px;
      margin: 10px;
      background-color: #fff;
      border-radius: 6px;
      font-family: sans-serif;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }

    .postItem h3 {
      margin: 0 0 8px;
      font-size: 18px;
      color: #333;
    }

    .postItem p {
      margin: 0;
      font-size: 14px;
      color: #555;
      white-space: pre-line;
    }
  </style>
</head>
<body id="body">
  <script type="module">
  import {
    createElementToStart,
    addCSSClass,
    createElementWithText,
    setEvent
  } from '../backend/htmlGenerater.js';

  import { loadUsersToMenu } from '../backend/Users.js';
  import { loadTodosForUser } from '../backend/TODO.js';
  import { loadPostsForUser } from '../backend/Posts.js';
  import { renderBreadcrumbs } from '../backend/breadcrumbs.js';
  import { handleHashNavigation } from '../backend/endpoint.js';

  const body = document.getElementById("body");
  window.currentUserId = null;
  window.currentUsername = null;
  window.currentView = null;

  // Создание контейнеров
  createElementToStart("div", body, "users");
  addCSSClass("chooseUserMenu", "users");

  createElementToStart("div", body, "todo");
  addCSSClass("menuTODO", "todo");

  createElementWithText("div", body, "breadcrumbs", null, "breadcrumbsMenu");

  const nav = createElementWithText("div", body, "topNavMenu", null, "topNavMenu");
  // nav.style.display = "none"; // УБРАНО: меню всегда видно

  const todoBtn = createElementWithText("button", nav, null, "TODO");
  todoBtn.onclick = () => {
    if (window.currentUserId !== null) {
      window.currentView = "TODO";
      window.location.hash = `#userID:${window.currentUserId}:TODO`;
    }
  };

  const postsBtn = createElementWithText("button", nav, null, "Посты");
  postsBtn.onclick = () => {
    if (window.currentUserId !== null) {
      window.currentView = "Posts";
      window.location.hash = `#userID:${window.currentUserId}:Posts`;
    }
  };

  // Глобальный обработчик выбора пользователя
  window.onUserSelected = function(userId, username) {
    window.currentUserId = userId;
    window.currentUsername = username;
    window.currentView = null;

    document.getElementById("todo").innerHTML = "";
    // nav.style.display = "flex"; // УБРАНО: меню всегда видно

    renderBreadcrumbs(userId, username);
  };

  // Загрузка пользователей
  loadUsersToMenu("users", "todo");

  // Навигация по хэшу
  window.addEventListener("hashchange", handleHashNavigation);
  window.addEventListener("DOMContentLoaded", handleHashNavigation);
</script>

</body>
</html>
